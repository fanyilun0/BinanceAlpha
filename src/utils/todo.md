这是一个针对 Discord Webhook 消息推送的完整优化方案文档。目前的“纯文本表格”模式在移动端阅读体验差，且容易受限于字符宽度导致数据（如 T-2 列）被截断。

我们将采用 **“分层展示 + 视觉可视化”** 的策略：对于高权重的“强信号”，使用独立的富媒体卡片（Rich Embed）；对于批量数据，使用优化后的列表视图。

-----

# Discord Webhook 告警优化方案

## 1\. 核心设计理念：分层展示

不要试图把所有信息塞进一张大表里。将告警分为两类：

  * **一级告警 (High Priority):** 确信度高（Score \> 0.8）的信号（如“稳定吸筹”、“洗盘结束”）。**策略：单币单卡片**，详细展示三日数据。
  * **二级告警 (Summary):** 普通的交易量异动或低分值信号。**策略：紧凑列表**，仅展示关键指标。

-----

## 2\. 视觉展示方案 (Visual Design)

### 方案 A：一级告警 - "信号详情卡片" (Signal Card)

**适用场景：** 检测到明确的 `ACCUMULATION_STABLE` (吸筹) 或 `WASH_COMPLETE` (洗盘结束)。
**优势：** 手机端完美适配，数据无截断，利用颜色和排版强调重点。

**Embed 结构设计：**

  * **Color Strip:**
      * 🟪 紫色：强力吸筹 (Accumulation)
      * 🟨 黄色：洗盘结束 (Wash Complete)
      * 🟩 绿色：牛旗/上涨中继 (Bull Flag)
  * **Title:** `[Token] 发现强力吸筹信号 (置信度: 0.9)`
  * **Description:** `当前价格: $1.23 (+0.5%) | 市值: $500M`
  * **Fields (字段布局):**
      * **Field 1: 3日量价趋势 (核心优化点)**
          * 不要用表格，用箭头和 Emoji 表达趋势。
          * *内容示例：*
            > **T-2:** Vol 100M (TR 15%) | Price $1.20
            > **T-1:** Vol 105M (TR 16%) | Price $1.21
            > **T-0:** Vol 102M (TR 15%) | Price $1.22
            > **结论:** 📉 量能收敛 + ➡ 价格横盘
      * **Field 2: 换手率分析**
          * *内容示例：* `15.5% (高位换手，主力控盘)`
      * **Field 3: 信号解读**
          * *内容示例：* 连续3日量能极度稳定 (CV=0.05)，价格波动 \<1%，疑似庄家高位吸筹。

-----

### 方案 B：二级告警 - "紧凑概览列表" (Compact List)

**适用场景：** 批量展示普通的量价异动。
**优势：** 解决表格在手机上换行错位的问题。

**弃用 ASCII 表格，改用“多行文本块”：**
不要尝试对齐 `|` 竖线。使用 Discord 的 Markdown 引用块 `>` 或者代码块配合 Emoji。

**格式设计：**

  * **Title:** 📊 市场异动概览 (Top 5)
  * **Description:**
    ```text
    1. BTC (Bitcoin)
    ├─ 24h Vol: $50B (+60% 🚀)
    ├─ Price: $98,000 (-2.5% 📉)
    └─ Status: ⚠️ 放量下跌 (疑似出货)

    2. ETH (Ethereum)
    ├─ 24h Vol: $20B (+10% ↗)
    ├─ Price: $4,000 (+0.1% ➡)
    └─ Status: 🐋 量增价平 (疑似吸筹)
    ```

-----

## 3\. 数据载荷构建规范 (Payload Structure)

为了解决“T-2 列消失”的问题，你需要重构传递给 Discord 函数的数据结构。目前的 `table_builder` 函数过于死板。

### 优化前的逻辑缺陷

目前的逻辑试图通过字符串拼接算空格，这在不同设备上字体渲染不同，极易对不齐。且 Embed 的 Value 字段限制 1024 字符，宽表格很容易超限。

### 优化后的逻辑流程

#### 步骤 1：预处理三日数据字符串

在生成 Embed 之前，先为每个 Token 生成一段格式化好的 **"趋势字符串"**。

  * **趋势可视化:** 比较 T-2, T-1, T0 的数值，生成对应的 Emoji 链。
      * `Vol: 10M ➔ 5M ➔ 2M` (缩量)
      * `Price: $1 ➔ $0.9 ➔ $1` (止跌)

#### 步骤 2：使用 Embed Fields 而非 Description 表格

利用 Discord Embed 的 `add_field` 功能。

  * **对于强信号：** 一个 Embed 只放一个 Token，使用 `inline=True/False` 布局 T-2, T-1, T0 数据。
  * **对于列表：** 一个 Embed 放多个 Field，每个 Field 代表一个 Token。
      * Field Name: `BTC | +5% Price | +50% Vol`
      * Field Value: `T-2: 100M | T-1: 120M | T-0: 200M`

-----

## 4\. 实施细节文档

### A. 颜色编码标准 (Visual Coding)

  * `0x9b59b6` (Purple): **吸筹 (Accumulation)** - 重点关注
  * `0xf1c40f` (Yellow): **洗盘结束 (Wash Complete)** - 抄底机会
  * `0x2ecc71` (Green): **牛旗/上涨 (Bull Flag/Pump)** - 追涨机会
  * `0xe74c3c` (Red): **出货/暴跌 (Distribution/Dump)** - 风险提示

### B. 解决 T-2 显示问题的具体排版

不要把 T-2, T-1, T0 放在同一行作为列。**改为垂直堆叠**。

**原来的 (错误):**

```
Sym | T-2 | T-1 | T0
BTC | 100 | 200 | 300  <-- 手机上这行会断成两截
```

**新的 (正确):**
**Title:** BTC 分析
**Field Value:**

> 📅 **T-2 (前天):** Vol 100M | TR 5%
> 📅 **T-1 (昨天):** Vol 200M | TR 10%
> 📅 **T-0 (今天):** Vol 300M | TR 15%
> 📊 **趋势:** 持续放量吸筹

### C. 告警发送频率控制

  * **聚合发送:** 不要检测到一个发一个。将所有“强吸筹”信号收集到一个 List，如果数量 \< 3，发 3 个单独的高级卡片。如果数量 \> 10，仅发送 Top 3 的高级卡片，剩下的放入“概览列表”。

-----

## 5\. 总结：给你的行动清单

1.  **废弃 `_build_table` 系列函数：** 停止使用字符串拼接表格。
2.  **创建 `create_signal_embed` 函数：** 专门用于生成单个 Token 的详细分析卡片（包含 T-2/T-1/T0 的垂直列表）。
3.  **创建 `create_summary_embed` 函数：** 用于生成多 Token 的简报。
4.  **数据格式化：** 在 Python 端预先计算好换手率（Turnover Rate）并格式化为百分比字符串，不要在 Discord 渲染层计算。
5.  **添加 Footer：** 在 Footer 中注明判定逻辑（例如：“吸筹判定：连续3日CV\<0.15”），方便回溯。

这种方案不仅解决了数据显示不全的问题，还大大提升了作为“交易辅助工具”的专业感和可读性。