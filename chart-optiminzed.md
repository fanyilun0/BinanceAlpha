# 图表可视化优化方案 (Chart Optimization Plan)

针对当前 `VolumeChartEcharts.vue` 中存在的“数据不完整（时间线缺失）”和“数据量大导致显示密集”这两个核心问题，提出以下针对性的优化方案。

## 1. 问题一：数据不完整 (Incomplete Data Handling)

**问题描述**：代币的交易量记录在时间线上不连续，存在缺失值。如果直接渲染，会导致图表线条断裂、X轴对齐错位或误导性的连线。

### 优化策略

#### 1.1 数据对齐与标准化 (Data Alignment & Normalization)
**核心原则**：确保所有 Series 的数据长度与 X 轴（时间轴）完全一致。
*   **实施方案**：
    *   构建一个包含所有时间点的标准时间轴数组 `AllDates`。
    *   在前端预处理阶段，遍历每个 Token 的数据。如果某个时间点缺失数据，**显式填充占位符**。
    *   **填充策略**：
        *   **交易量 (Volume)**: 缺失通常意味着无交易，建议填充为 `0`。
        *   **价格/变化率 (Change)**: 缺失意味着未知，建议填充为 `null`。

#### 1.2 视觉连续性处理 (Visual Continuity)
**核心原则**：在保证数据真实性的前提下，优化视觉体验。
*   **断点处理 (Break vs Connect)**:
    *   对于 **变化率图表**：保持 `connectNulls: false`。让用户清楚地看到数据中断，避免错误的趋势暗示。
    *   对于 **交易量图表**：由于填充了 `0`，线条会自然掉落到 X 轴，这是符合逻辑的。
*   **辅助标识**:
    *   在 Tooltip 中，对于填充的数据点，显示 "无数据" 或 "0 (无交易)"，以区分“真实发生的0交易”和“数据缺失”。

#### 1.3 稀疏数据优化 (Sparse Data Optimization)
*   如果某些 Token 数据过于稀疏（例如只有 10% 的时间点有数据），建议在图表中**自动过滤**掉这些 Token，或将其归类到“低活跃度”分组中，避免它们干扰主要趋势的观察。

---

## 2. 问题二：数据密集导致显示混乱 (High Data Density & Clutter)

**问题描述**：当展示大量 Token 时，线条相互遮挡，形成“意大利面条”效应，且 Tooltip 过长无法阅读。

### 优化策略

#### 2.1 "Top N + Others" 聚合模式 (Aggregation)
**核心原则**：不要试图一次性展示所有细节。
*   **实施方案**：
    *   **动态分组**: 将 Token 分为两类：
        1.  **焦点组 (Focus Group)**: 选出 Top 5-10 个关键 Token（按交易量或波动率排序），独立展示线条。
        2.  **聚合组 (Aggregated Group)**: 剩余的所有 Token，计算其**平均值**或**中位数**，合并渲染为一条“市场平均”或“其他代币”的虚线/灰色宽线。
    *   **交互**: 用户点击“其他代币”线时，可以展开查看其中的 Top N，或者通过侧边栏将特定 Token 移入“焦点组”。

#### 2.2 聚焦交互模式 (Focus Interaction)
**核心原则**：通过交互来减少视觉噪音。
*   **Hover Dimming (悬停高亮)**:
    *   当鼠标悬停在某条线或图例上时，**将其他所有线条的透明度降低至 0.1**，仅高亮当前选中的线条。
    *   这能让用户在密集的线条中瞬间看清特定 Token 的走势。

#### 2.3 智能 Y 轴缩放 (Smart Y-Axis Scaling)
**核心原则**：防止个别极端数据压缩整体视图。
*   **异常值处理**:
    *   在“变化率”模式下，如果某个 Token 暴涨 1000%，会把其他 10%-20% 波动的 Token 压成直线。
    *   **方案**: 引入 `scale: true` 并设置合理的 `max` / `min` 阈值（例如截断超过 200% 的部分），或者使用 **对数坐标 (Log Axis)** 来平滑极端差异。

#### 2.4 密度自适应渲染 (Density-Adaptive Rendering)
*   **根据缩放级别调整细节**:
    *   **宏观视角 (Zoom Out)**: 仅显示 Top 5 线条 + 市场平均线。
    *   **微观视角 (Zoom In)**: 当用户放大到特定时间段时，自动显示更多细节线条，因为此时数据点间距变大，视觉干扰减少。

---

## 3. 实施路线图 (Implementation Roadmap)

1.  **数据预处理层升级**:
    *   实现 `alignDataToTimeline(tokens, allDates)` 函数，解决数据缺失和对齐问题。
2.  **交互层升级**:
    *   实现 ECharts 的 `emphasis` 配置，开启“悬停高亮”功能。
    *   修改 Tooltip 逻辑，仅显示 Top 10 + "Others (Avg: XX)"。
3.  **视图层升级**:
    *   实现“Top N + Others”聚合逻辑，计算并渲染平均线。

通过以上方案，既能真实反映数据（包括缺失情况），又能在大数据量下保持图表的可读性和交互性。
